<!DOCTYPE html>
<html>

<head>
    <title>Latest Temperature Display</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .temperature-display {
            font-size: 2em;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="jumbotron mt-3">
            <h1 class="display-4">Latest Temperature Display</h1>
            <p class="lead">Real-time Temperature Monitoring</p>
        </div>

        <!-- Temperature Display -->
        <div id="temperatureDisplay" class="temperature-display"></div>

        <!-- Last Update Time -->
        <div id="lastUpdate" class="text-muted"></div>
    </div>

    <script>
        async function fetchLatestTemperature() {
            try {
                const response = await fetch('https://gettempfromthehub.azurewebsites.net/api/getLatestTemp');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching temperature:', error);
                return null;
            }
        }

        async function updateTemperatureDisplay() {
    try {
        const temperatureData = await fetchLatestTemperature();
        if (temperatureData && temperatureData.Temperature !== undefined) {
            // Parse the JSON string to an object
            const parsedTemperatureData = JSON.parse(temperatureData);

            const temperatureDisplayElement = document.getElementById('temperatureDisplay');
            temperatureDisplayElement.textContent = `Latest Temperature: ${parsedTemperatureData.Temperature} Â°C`;

            // Update last update time
            const lastUpdateElement = document.getElementById('lastUpdate');
            lastUpdateElement.textContent = `Last Update Time: ${new Date(parsedTemperatureData.Timestamp).toLocaleTimeString()}`;
        } else {
            throw new Error("Invalid temperature data");
        }
    } catch (error) {
        console.error('Error updating temperature display:', error);
    }
}

        async function refreshTemperaturePeriodically() {
            while (true) {
                await updateTemperatureDisplay();
                await new Promise(resolve => setTimeout(resolve, 5000)); // Refresh every 5 seconds
            }
        }

        // Initial update and start automatic refreshing
        async function init() {
            await updateTemperatureDisplay();
            refreshTemperaturePeriodically();
        }

        window.onload = init;
    </script>
</body>

</html>
